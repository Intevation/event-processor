<meta charset="UTF-8">
<!--
curl -O https://vuejs.org/js/vue.js
head -2 vue.js | tail -1
# * Vue.js v2.0.3
 sha256sum vue.js
#3fe87287929f07ad9a590e2ffbcff3656c0c76966c762a5feee531c42a68c1d1  vue.js
-->
<script src="./vue.js" type="text/javascript"></script>
<!--
curl -O https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js
sha256sum vue-resource.min.js
#af5a73780d4b0913d00fda1eb8d0cfe13f1fb72b6aef06928259a621209f13d2  vue-resource.min.js
-->
<script src="./vue-resource.min.js" type="text/javascript"></script>

<h1>Checking an intelmq CERT-Bund Ticket</h1>
<div id="checkticket">
  Ticket#
  <input v-model:title="ticketID" placeholder="20161020-10000004">
  <button v-on:click="lookupIDs">go</button>
  <p>Event IDs:
  <span>{{ eventIDs }}
  <button v-on:click="loadDetails">details</button>
  </span>
  <p>
  Event Details:
  <span>{{ events }}</span>
  <p>
  <h4>developers log</h4>
  <div id='log'></div>
</div>

<script type="text/javascript">
'use strict';

function log(html) {
   var logElement = document.getElementById('log');
   logElement.insertAdjacentHTML('beforeend', '<p>' + html);
}

var ticketid = new Vue({
  el: '#checkticket',
  data: {
    queryURL: 'http://localhost:8000/',
    ticketID: '20161020-10000004', // TODO remove example
    eventIDs: [],
    events: []
  },
  methods: {
    lookupIDs : function () {
      var url = this.queryURL + '/getEventIDsForTicket?ticket=' + this.ticketID;
      this.$http.get(url).then((response) => {
        response.json().then((value) => {
	  this.eventIDs = value;
	});
      }, (response) => {
        this.eventIDs = []
      });
    },
    loadDetails : function () {
      var url = this.queryURL + '/getEvents?';
      for(var i = 0, size = this.eventIDs.length; i < size ; i++){
        url += 'ids=' + this.eventIDs[i] + '&';
      }
      log('Trying to load ' + url);

      this.$http.get(url).then((response) => {
        // success
	log('Result: ' + response.body);
	response.json().then((value) => {
	  this.events = value;
	});
      }, (response) => {
        // failure
        this.events = []
      });
    }
  }
})
</script>
